
<!DOCTYPE html>
<html lang="zh-CN" class="loading">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lucine-XL</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate">
    <meta name="keywords" content="LucineXL,"> 
    <meta name="description" content="我是一个小码农~,"> 
    <meta name="author" content="Lucine"> 
    <link rel="alternative" href="atom.xml" title="Lucine-XL" type="application/atom+xml"> 
    <link rel="icon" href="/img/li.png"> 
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <link rel="stylesheet" href="/css/diaspora.css">
    <!-- <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> -->
    <script>
    //   (adsbygoogle = window.adsbygoogle || []).push({
    //     google_ad_client: "ca-pub-8691406134231910",
    //     enable_page_level_ads: true
    //   });
    </script>

</head>
</html>
<body class="loading">
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="icon-home image-icon" href="javascript:;"></a>
    <div title="播放/暂停" class="icon-play"></div>
    <h3 class="subtitle">解决安卓软键盘弹起后遮住输入框问题</h3>
    <div class="social">
        <!--<div class="like-icon">-->
            <!--<a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
        <!--</div>-->
        <div>
            <div class="share">
                <a title="获取二维码" class="icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>
    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">解决安卓软键盘弹起后遮住输入框问题</h1>
        <div class="stuff">
            <span>四月 13, 2020</span>
            
  <ul class="post-tags-list"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/h5/">h5</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/移动端适配/">移动端适配</a></li></ul>


        </div>
        <div class="content markdown">
            <p>最近在做项目时， 遇到了安卓端输入法输入文字时软键盘弹起来会将输入框遮住的问题。</p>
<p>如下图， 在点开个人电话输入框后， 软键盘弹起遮住了输入框</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gds8rh3d5zj317t0u07wh.jpg" alt></p>
<p>在ios上， 输入框激活后， 当前输入框会自动滚动至可视位置， 这正是我们想要的效果</p>
<div align="center"><br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gds8yquaxtj30jm0y2tdr.jpg" width="300" height="300" div align="center"><br></div>


<p>这是一个很常见的兼容性问题， 应该有比较完善的解决方案了吧，所以我首先去百度了一番， 但是搜出来的大部分结果都是修改app的相关文件， 但是因为我的项目是在微信中打开的， 所以这类解决方案并不能解决我的问题。</p>
<p>最后， 我找到了 <code>scrollIntoView</code></p>
<h4 id="Element-scrollIntoView-方法让当前的元素滚动到浏览器窗口的可视区域内。"><a href="#Element-scrollIntoView-方法让当前的元素滚动到浏览器窗口的可视区域内。" class="headerlink" title="Element.scrollIntoView() 方法让当前的元素滚动到浏览器窗口的可视区域内。"></a>Element.scrollIntoView() 方法让当前的元素滚动到浏览器窗口的可视区域内。</h4><p>scrollIntoView() 有两种使用方式： （更详细的介绍戳这里<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/scrollIntoView" target="_blank" rel="noopener">MDN: Element.scrollIntoView()</a>）</p>
<p><b>1. element.scrollIntoView(alignToTop)<b></b></b></p>
<p>alignToTop:  Boolean型参数, 默认为 true</p>
<p>true: 元素的顶端将和其所在滚动区的可视区域的顶端对齐， 相当于 <code>scrollIntoViewOptions: {block: &quot;start&quot;, inline: &quot;nearest&quot;}</code><br>false: 元素的底端将和其所在滚动区的可视区域的底端对齐, 相当于 <code>scrollIntoViewOptions: {block: &quot;end&quot;, inline: &quot;nearest&quot;}</code></p>
<p><b>2. element.scrollIntoView(scrollIntoViewOptions)<b></b></b></p>
<p>scrollIntoViewOptions: 配置参数， 包含以下属性:<br>behavior (可选) : 定义动画过渡效果， “auto”或 “smooth” 之一。默认为 “auto”。<br>block (可选): 定义垂直方向的对齐， “start”, “center”, “end”, 或 “nearest”之一。默认为 “start”。<br>inline (可选): 定义水平方向的对齐， “start”, “center”, “end”, 或 “nearest”之一。默认为 “nearest”。</p>
<h4 id="v1-0"><a href="#v1-0" class="headerlink" title="v1.0"></a>v1.0</h4><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const onFocus = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">document</span>.activeElement.scrollIntoView(&#123; block: <span class="string">'center'</span>, inline: <span class="string">'nearest'</span> &#125;);</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure>
<p>给input组件添加onFocus事件， 这样添加之后， 可以明显看出页面确实滚动了， 但是滚动的位置不对。</p>
<p>现在的效果是页面先进行滚动， 选中的输入框滚动至页面中央， 但是页面底部的footer滚动到了软键盘上方的位置， 并且又盖住了输入框（页面底部的footer是固定高度，上方的内容部分采用了 <code>flex： 1</code>的方式撑开）。</p>
<h4 id="v2-0"><a href="#v2-0" class="headerlink" title="v2.0"></a>v2.0</h4><p>既然是页面先发生了滚动， 所以加一个延时， 500ms之后进行滚动，这样应该就可以了吧</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const onFocus = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.activeElement.scrollIntoView(&#123; block: <span class="string">'center'</span>, inline: <span class="string">'nearest'</span> &#125;);</span><br><span class="line">  &#125;, <span class="number">500</span>);</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure>
<p>加了计时器之后， 确实大部分情况都已经没问题了， 但是偶尔还是会出现页面滚动比较慢的情况， 可是如果把时间改成1s的话， 整个页面看着会有些卡顿， 而且理论上来说， 这样仍然还是会有出现问题的的可能。</p>
<h4 id="v3-0"><a href="#v3-0" class="headerlink" title="v3.0"></a>v3.0</h4><p>实现思路：<br>软键盘弹起后， 页面body的高度发生了变化， 使用 <code>window.innerHeight</code> 可以获取当前可视部分的高度， 每隔100ms进行一次检测， 一旦<code>window.innerHeigh</code>发生变化， 将输入框滚动至可视区域</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">const scrollPage = use<span class="constructor">Callback((<span class="params">oldHeight</span>, <span class="params">oldTime</span>, <span class="params">currentoffsetTop</span>)</span> =&gt; &#123;</span><br><span class="line">    set<span class="constructor">Timeout(()</span> =&gt; &#123;</span><br><span class="line">      const currentTimeOffset = <span class="keyword">new</span> <span class="constructor">Date()</span> - oldTime;</span><br><span class="line">      <span class="comment">// 记录时间， 最长时间800ms ， 800ms后没有检测到改变， 则不进行任何操作（正常情况下 800ms应该足够了）</span></span><br><span class="line">      <span class="keyword">if</span> (currentTimeOffset &lt; <span class="number">800</span>) &#123;</span><br><span class="line">        const currentHeight = window.innerHeight;</span><br><span class="line">        <span class="comment">// 判断何时进行滚动</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="module-access"><span class="module"><span class="identifier">Math</span>.</span></span>abs(oldHeight - currentHeight) &gt; <span class="number">50</span><span class="operator"> &amp;&amp; </span>currentoffsetTop &gt; currentHeight) &#123;</span><br><span class="line">          document.activeElement.scroll<span class="constructor">IntoView(&#123; <span class="params">block</span>: '<span class="params">center</span>', <span class="params">inline</span>: '<span class="params">nearest</span>' &#125;)</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          scroll<span class="constructor">Page(<span class="params">oldHeight</span>, <span class="params">oldTime</span>, <span class="params">currentoffsetTop</span>)</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">100</span>);</span><br><span class="line">  &#125;, <span class="literal">[]</span>);</span><br><span class="line"></span><br><span class="line">  const onFocus = use<span class="constructor">Callback(()</span> =&gt; &#123;</span><br><span class="line">    <span class="comment">// 只有安卓的时候需要执行这个操作</span></span><br><span class="line">    <span class="keyword">if</span> (!isPc<span class="operator"> &amp;&amp; </span>!isIOS) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 获取当前输入框距离可视区域顶部的高度和输入框高度</span></span><br><span class="line">      const &#123; top, height &#125; = document.activeElement.get<span class="constructor">BoundingClientRect()</span>;</span><br><span class="line">      const currentoffsetTop = top + (height<span class="operator"> / </span><span class="number">32</span>)<span class="operator"> * </span>(<span class="number">68</span> + <span class="number">32</span>);</span><br><span class="line"></span><br><span class="line">      const oldHeight = window.innerHeight;</span><br><span class="line">      const oldTime = <span class="keyword">new</span> <span class="constructor">Date()</span>;</span><br><span class="line">      scroll<span class="constructor">Page(<span class="params">oldHeight</span>, <span class="params">oldTime</span>, <span class="params">currentoffsetTop</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="literal">[<span class="identifier">scrollPage</span>]</span>);</span><br></pre></td></tr></table></figure>
<p>到此为止， 已经可以满足我们的需求了</p>
<h4 id="v4-0"><a href="#v4-0" class="headerlink" title="v4.0"></a>v4.0</h4><p>公共方法提取</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解决安卓输入框输入时软键盘弹起后盖住输入框问题</span></span><br><span class="line"><span class="comment"> * footHeight: 底部有fix固定的button时， button的高度， 默认为 68</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> focus<span class="constructor">AndScroll(<span class="params">footHeight</span> = 68)</span> &#123;</span><br><span class="line">  const activeElement = document.activeElement;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!is<span class="constructor">PC()</span><span class="operator"> &amp;&amp; </span>!isIOS<span class="operator"> &amp;&amp; </span>activeElement) &#123;</span><br><span class="line">      const &#123; top, height &#125; = activeElement.get<span class="constructor">BoundingClientRect()</span>;</span><br><span class="line">      const offsetTop = top + (height<span class="operator"> / </span><span class="number">32</span>)<span class="operator"> * </span>(footHeight + <span class="number">32</span>);</span><br><span class="line">      const innerHeight = window.innerHeight;</span><br><span class="line">      const time = <span class="keyword">new</span> <span class="constructor">Date()</span>;</span><br><span class="line"></span><br><span class="line">      const scrollPage =<span class="function"> (<span class="params">oldHeight</span>, <span class="params">oldTime</span>, <span class="params">currentoffsetTop</span>) =&gt;</span> &#123;</span><br><span class="line">        set<span class="constructor">Timeout(()</span> =&gt; &#123;</span><br><span class="line">          const currentTimeOffset = <span class="keyword">new</span> <span class="constructor">Date()</span> - oldTime;</span><br><span class="line">          <span class="keyword">if</span> (currentTimeOffset &lt; <span class="number">800</span>) &#123;</span><br><span class="line">            const currentHeight = window.innerHeight;</span><br><span class="line">            <span class="keyword">if</span> (<span class="module-access"><span class="module"><span class="identifier">Math</span>.</span></span>abs(oldHeight - currentHeight) &gt; <span class="number">50</span><span class="operator"> &amp;&amp; </span>currentoffsetTop &gt; currentHeight) &#123;</span><br><span class="line">              activeElement.scroll<span class="constructor">IntoView(&#123; <span class="params">block</span>: '<span class="params">center</span>', <span class="params">inline</span>: '<span class="params">nearest</span>' &#125;)</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              scroll<span class="constructor">Page(<span class="params">oldHeight</span>, <span class="params">oldTime</span>, <span class="params">currentoffsetTop</span>)</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="number">50</span>);</span><br><span class="line">      &#125;;</span><br><span class="line">      scroll<span class="constructor">Page(<span class="params">innerHeight</span>, <span class="params">time</span>, <span class="params">offsetTop</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; catch (e) &#123;</span><br><span class="line">    console.error(e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// onFocus调用</span></span><br><span class="line">const onFocus = use<span class="constructor">Callback(()</span> =&gt; &#123;</span><br><span class="line">    focus<span class="constructor">AndScroll()</span>;</span><br><span class="line">&#125;, <span class="literal">[]</span>);</span><br></pre></td></tr></table></figure>
<p>这样 ，这个问题就可以啦~</p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        <li title='0' data-url='http://link.hhtjim.com/163/5146554.mp3'></li>
                    
                        <li title='1' data-url='http://link.hhtjim.com/qq/001faIUs4M2zna.mp3'></li>
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
        data-ae='false'
        data-ci='875d3015f05abfc0a79b'
        data-cs='3192ac1526e44e82c6ff33702190a4123689a827'
        data-r='LucineXL.github.io'
        data-o='LucineXL'
        data-a='LucineXL'
        data-d='false'
    >查看评论</div>


    </div>
    
</div>


    </div>
</div>
</body>
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/diaspora.js"></script>
<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">
<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>


<!-- 
 -->
</html>