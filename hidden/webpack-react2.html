
<!DOCTYPE html>
<html lang="zh-CN" class="loading">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lucine-XL</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate">
    <meta name="keywords" content="LucineXL,"> 
    <meta name="description" content="我是一个小码农~,"> 
    <meta name="author" content="Lucine"> 
    <link rel="alternative" href="atom.xml" title="Lucine-XL" type="application/atom+xml"> 
    <link rel="icon" href="/img/li.png"> 
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <link rel="stylesheet" href="/css/diaspora.css">
    <!-- <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> -->
    <script>
    //   (adsbygoogle = window.adsbygoogle || []).push({
    //     google_ad_client: "ca-pub-8691406134231910",
    //     enable_page_level_ads: true
    //   });
    </script>

</head>
</html>
<body class="loading">
    <div id="loader"></div>
    <div id="single" class="page">
    <div id="top">
        <a class="icon-left image-icon" href="javascript:history.back()"></a>
    </div>
    <div class="section">
        <div class="article">
            <div class="main">
                <div class="content">
                    <p>  上一篇文章我们已经基本实现了一个简单的框架， 现在， 我们继续把我们的项目完善一下~</p>
<p>  <a href="https://lucinexl.github.io/2018/08/21/webpack-react/"><font color="#518dca">上一篇：基于 webpack4 搭建 一个简单 的 React 脚手架 （一）</font></a></p>
<p>  <a href="https://github.com/LucineXL/webpackAndReact" target="_blank" rel="noopener"><font color="#518dca">项目git地址</font></a></p>
<p>  <a href="https://www.webpackjs.com/concepts/" target="_blank" rel="noopener"><font color="#518dca">webpack4 官方文档 ，请戳这里~</font></a></p>
<h2 id="生产环境构建"><a href="#生产环境构建" class="headerlink" title="生产环境构建"></a>生产环境构建</h2><p>   开发环境(development)和生产环境(production)的构建目标差异很大, 所以我们在使用时通常会为每个环境编写一个独立的配置文件。为了出现大量的重复代码， 我们可以提取一个公共的配置文件， 通过  webpack-merge 可以把webpack合并起来。</p>
<p>   webpack-merge 安装</p>
<pre><code>yarn add webpack-merge -D
</code></pre><p>   最终， 我们的 代码结构如下：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">dist</span></span><br><span class="line"><span class="selector-tag">src</span></span><br><span class="line"><span class="selector-class">.babelrc</span></span><br><span class="line"><span class="selector-tag">package</span><span class="selector-class">.json</span></span><br><span class="line"><span class="selector-tag">webpack</span></span><br><span class="line">├── <span class="selector-tag">webpack</span><span class="selector-class">.common</span><span class="selector-class">.js</span></span><br><span class="line">├── <span class="selector-tag">webpack</span><span class="selector-class">.dev</span><span class="selector-class">.js</span></span><br><span class="line">└── <span class="selector-tag">webpack</span><span class="selector-class">.prod</span><span class="selector-class">.js</span></span><br></pre></td></tr></table></figure></p>
<p>   webpack.common.js:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">const</span> <span class="string">path = require('path');</span></span><br><span class="line"></span><br><span class="line"><span class="meta">module.exports</span> = <span class="string">&#123;</span></span><br><span class="line"><span class="attr">entry</span>: <span class="string">&#123;</span></span><br><span class="line">    <span class="attr">app</span>: <span class="string">'./src/index.js'</span></span><br><span class="line"><span class="attr">&#125;,</span></span><br><span class="line"><span class="attr">module</span>: <span class="string">&#123;</span></span><br><span class="line">    <span class="attr">rules</span>: <span class="string">[</span></span><br><span class="line">        <span class="attr">&#123;</span></span><br><span class="line">            <span class="attr">test</span>: <span class="string">/\.js$/,</span></span><br><span class="line">            <span class="attr">include</span>: <span class="string">path.resolve(__dirname, '../src'),</span></span><br><span class="line">            <span class="attr">use</span>: <span class="string">&#123;</span></span><br><span class="line">                <span class="attr">loader</span>: <span class="string">"babel-loader"</span></span><br><span class="line">            <span class="attr">&#125;</span></span><br><span class="line">        <span class="attr">&#125;</span></span><br><span class="line">    <span class="attr">]</span></span><br><span class="line"><span class="attr">&#125;,</span></span><br><span class="line"><span class="attr">plugins</span>: <span class="string">[],</span></span><br><span class="line"><span class="attr">output</span>: <span class="string">&#123;</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">'[name].bundle.js',</span></span><br><span class="line">    <span class="attr">path</span>: <span class="string">path.resolve(__dirname, '../dist')</span></span><br><span class="line"><span class="attr">&#125;</span></span><br><span class="line"><span class="attr">&#125;;</span></span><br></pre></td></tr></table></figure>
<p>   webpack.dev.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>);</span><br><span class="line"><span class="keyword">const</span> common = <span class="built_in">require</span>(<span class="string">'./webpack.common.js'</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(common, &#123;</span><br><span class="line">  mode: <span class="string">'development'</span>,</span><br><span class="line">  devtool: <span class="string">'inline-source-map'</span>,</span><br><span class="line">  devServer:&#123;</span><br><span class="line">    contentBase:path.join(__dirname,<span class="string">"../src"</span>),</span><br><span class="line">    compress: <span class="literal">true</span>,</span><br><span class="line">    port: <span class="number">8033</span>,</span><br><span class="line">    hot: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: <span class="string">'./src/index.html'</span>,</span><br><span class="line">      inject: <span class="string">'body'</span>,</span><br><span class="line">      minify: &#123;</span><br><span class="line">          html5: <span class="literal">true</span></span><br><span class="line">      &#125;,</span><br><span class="line">      hash: <span class="literal">false</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>   webpack.prod.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>);</span><br><span class="line"><span class="keyword">const</span> common = <span class="built_in">require</span>(<span class="string">'./webpack.common.js'</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> CleanWebpackPlugin = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(common, &#123;</span><br><span class="line">  mode: <span class="string">'production'</span>,</span><br><span class="line">  plugins:[</span><br><span class="line">    <span class="keyword">new</span> CleanWebpackPlugin([<span class="string">'../dist'</span>], &#123; <span class="attr">allowExternal</span>: <span class="literal">true</span> &#125;),</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        minify:&#123; <span class="comment">//是对html文件进行压缩</span></span><br><span class="line">            removeAttributeQuotes: <span class="literal">true</span>  <span class="comment">//removeAttrubuteQuotes是却掉属性的双引号。</span></span><br><span class="line">        &#125;,</span><br><span class="line">        hash:<span class="literal">true</span>, <span class="comment">//为了开发中js有缓存效果，所以加入hash，这样可以有效避免缓存JS。</span></span><br><span class="line">        template:<span class="string">'./src/index.html'</span> <span class="comment">//是要打包的html模版路径和文件名称。</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="资源管理"><a href="#资源管理" class="headerlink" title="资源管理"></a>资源管理</h2><h4 id="1-加载css"><a href="#1-加载css" class="headerlink" title="1. 加载css"></a>1. 加载css</h4><p>安装 style-loader css-loade</p>
<pre><code>yarn add style-loader css-loader -D
</code></pre><p>webpack.config.js</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">   <span class="comment">// ...</span></span><br><span class="line">   <span class="keyword">module</span>: &#123;</span><br><span class="line">     rules: [</span><br><span class="line">       <span class="comment">// ...</span></span><br><span class="line">       &#123;</span><br><span class="line">         test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">         use: [</span><br><span class="line">           <span class="string">'style-loader'</span>,</span><br><span class="line">           <span class="string">'css-loader'</span></span><br><span class="line">         ]</span><br><span class="line">       &#125;</span><br><span class="line">     ]</span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="2-加载图片、字体"><a href="#2-加载图片、字体" class="headerlink" title="2. 加载图片、字体"></a>2. 加载图片、字体</h4><p>我们在写项目中引用路径的时候，填写的URL是基于我们开发时的路径， 但是在webpack打包时， 会将各个模块打包成一个文件，里面引用的路径是相对于入口html文件，并不是相对于我们的原始文件路径的。loader 可以解析项目中引入的URL，并且根据配置，把图片拷贝到相应路径， 再将打包后的文件中的路径 替换为图像的最终路径。 </p>
<p>file-loader 和 url-loader 都可以解决这个问题。 但是url-loader会将引入的图片进行编码， 我们引用的时候只需要引入这个文件就可以访问图片了， 可以大大减少 HTTP请求的次数。</p>
<p>url-loader 封装了 file-loader， 但并不依赖他， 所以我们可以只需要安装 url-loader就可以了。</p>
<p>安装 file-loader, url-loader </p>
<pre><code>yarn add file-loader url-loader -D
</code></pre><p>webpack.config.js</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">   <span class="comment">// ...</span></span><br><span class="line">   <span class="keyword">module</span>: &#123;</span><br><span class="line">     rules: [</span><br><span class="line">       <span class="comment">// ...</span></span><br><span class="line">       <span class="comment">// 加载图片</span></span><br><span class="line">       &#123;</span><br><span class="line">            test: <span class="regexp">/\.(png|svg|jpg|gif)$/</span>,</span><br><span class="line">            use: [</span><br><span class="line">                &#123;</span><br><span class="line">                    loader: <span class="string">'url-loader'</span>, <span class="comment">//是指定使用的loader和loader的配置参数</span></span><br><span class="line">                    options: &#123;</span><br><span class="line">                        limit:<span class="number">500</span>,  <span class="comment">//是把小于500B的文件打成Base64的格式，写入JS</span></span><br><span class="line">                        outputPath:<span class="string">'images/'</span>,  <span class="comment">//打包后的图片放到images文件夹下</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 加载字体文件</span></span><br><span class="line">        &#123;</span><br><span class="line">            test: <span class="regexp">/\.(woff|woff2|eot|ttf|otf)$/</span>,</span><br><span class="line">            use: [</span><br><span class="line">            <span class="string">'file-loader'</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">     ]</span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="3-加载数据"><a href="#3-加载数据" class="headerlink" title="3. 加载数据"></a>3. 加载数据</h4><p>  csv-loader、xml-loader 可以处理CSV、TSV 和 XML这三类文件。</p>
<p>  安装 csv-loader、xml-loader</p>
<pre><code>yarn add csv-loader xml-loader -D
</code></pre><p>  webpack.config.js<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">   <span class="comment">// ...</span></span><br><span class="line">   <span class="keyword">module</span>: &#123;</span><br><span class="line">     rules: [</span><br><span class="line">       <span class="comment">// ...</span></span><br><span class="line">       &#123;</span><br><span class="line">            test: <span class="regexp">/\.(csv|tsv)$/</span>,</span><br><span class="line">            use: [</span><br><span class="line">                <span class="string">'csv-loader'</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            test: <span class="regexp">/\.xml$/</span>,</span><br><span class="line">            use: [</span><br><span class="line">                <span class="string">'xml-loader'</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">     ]</span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h2 id="压缩输出"><a href="#压缩输出" class="headerlink" title="压缩输出"></a>压缩输出</h2><h4 id="1-使用uglifyjs-webpack-plugin对打包后的文件进行压缩"><a href="#1-使用uglifyjs-webpack-plugin对打包后的文件进行压缩" class="headerlink" title="1. 使用uglifyjs-webpack-plugin对打包后的文件进行压缩"></a>1. 使用uglifyjs-webpack-plugin对打包后的文件进行压缩</h4><p>uglifyjs-webpack-plugin （js 压缩插件）， 在webpack中默认集成，不需要额外安装。</p>
<p>webpack.prod.js</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> uglify = require(<span class="string">'uglifyjs-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = &#123;</span><br><span class="line">   <span class="comment">// ...</span></span><br><span class="line">   plugins:[</span><br><span class="line">       <span class="comment">// ...</span></span><br><span class="line">       <span class="keyword">new</span> uglify()</span><br><span class="line">   ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="关于-css"><a href="#关于-css" class="headerlink" title="关于 css"></a>关于 css</h2><h4 id="1-css-文件抽离"><a href="#1-css-文件抽离" class="headerlink" title="1. css 文件抽离"></a>1. css 文件抽离</h4><p>在webpack4 版本中， 我们可以使用 mini-css-extract-plugin 插件， 将打包在js文件中的css抽离出来</p>
<p>安装 mini-css-extract-plugin</p>
<pre><code>yarn add mini-css-extract-plugin -D
</code></pre><p>webpack.prod.conf.js<br><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">const</span> <span class="string">MiniCssExtractPlugin = require("mini-css-extract-plugin");</span></span><br><span class="line"></span><br><span class="line"><span class="meta">module.exports</span> = <span class="string">&#123;</span></span><br><span class="line">    <span class="attr">module</span>: <span class="string">&#123;</span></span><br><span class="line">        <span class="attr">rules</span>:<span class="string"></span></span><br><span class="line">            <span class="attr">[</span></span><br><span class="line">                <span class="attr">&#123;</span></span><br><span class="line">                    <span class="attr">test</span>: <span class="string">/\.(css)$/,</span></span><br><span class="line">                    <span class="attr">use</span>: <span class="string">[</span></span><br><span class="line">                        <span class="attr">&#123;</span></span><br><span class="line">                            <span class="attr">loader</span>: <span class="string">MiniCssExtractPlugin.loader,</span></span><br><span class="line">                            <span class="attr">options</span>: <span class="string">&#123;</span></span><br><span class="line">                                <span class="attr">publicPath</span>: <span class="string">'../',</span></span><br><span class="line">                            <span class="attr">&#125;</span></span><br><span class="line">                        <span class="attr">&#125;,</span></span><br><span class="line">                        <span class="attr">&#123;</span></span><br><span class="line">                            <span class="attr">loader</span>: <span class="string">'css-loader',</span></span><br><span class="line">                        <span class="attr">&#125;</span></span><br><span class="line">                    <span class="attr">]</span></span><br><span class="line">                <span class="attr">&#125;</span></span><br><span class="line">            <span class="attr">]</span></span><br><span class="line">    <span class="attr">&#125;,</span></span><br><span class="line">    <span class="attr">plugins</span>:<span class="string">[</span></span><br><span class="line">        <span class="meta">//</span> <span class="string">...</span></span><br><span class="line">        <span class="attr">new</span> <span class="string">MiniCssExtractPlugin(&#123;</span></span><br><span class="line">            <span class="attr">filename</span>: <span class="string">'css/[name].[hash].css',</span></span><br><span class="line">            <span class="attr">chunkFilename</span>: <span class="string">'css/[id].[hash].css',</span></span><br><span class="line">        <span class="attr">&#125;),</span></span><br><span class="line">    <span class="attr">]</span></span><br><span class="line"><span class="attr">&#125;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="2-css-压缩"><a href="#2-css-压缩" class="headerlink" title="2. css 压缩"></a>2. css 压缩</h4><p>使用 optimize-css-assets-webpack-plugin 插件来压缩 css</p>
<pre><code>yarn add optimize-css-assets-webpack-plugin -D
</code></pre><p>webpack.prod.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> OptimizeCssAssetsPlugin = <span class="built_in">require</span>(<span class="string">'optimize-css-assets-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    plugins:[</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">new</span> OptimizeCssAssetsPlugin(&#123;</span><br><span class="line">            assetNameRegExp:  <span class="regexp">/\.css\.*(?!.*map)/g</span>,</span><br><span class="line">            cssProcessor: <span class="built_in">require</span>(<span class="string">'cssnano'</span>),</span><br><span class="line">            cssProcessorPluginOptions: &#123;</span><br><span class="line">            preset: [<span class="string">'default'</span>, &#123; <span class="attr">discardComments</span>: &#123; <span class="attr">removeAll</span>: <span class="literal">true</span> &#125; &#125;],</span><br><span class="line">            &#125;,</span><br><span class="line">            canPrint: <span class="literal">true</span></span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-less-or-sass"><a href="#3-less-or-sass" class="headerlink" title="3. less or sass"></a>3. less or sass</h4><p>安装 sass-loader/less-loader, 需注意若使用的是 sass, 还需要安装 node-sass;</p>
<pre><code>yarn add node-sass sass-loader -D
</code></pre><p>webpack.dev.js</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                <span class="string">'style-loader'</span>,</span><br><span class="line">                <span class="string">'css-loader'</span>,</span><br><span class="line">                <span class="string">'sass-loader'</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>webpack.prod.js</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">module.exports</span> = <span class="string">&#123;</span></span><br><span class="line">    <span class="meta">//</span> <span class="string">...</span></span><br><span class="line">    <span class="attr">module</span>: <span class="string">&#123;</span></span><br><span class="line">        <span class="attr">rules</span>: <span class="string">[</span></span><br><span class="line">            <span class="meta">//</span> <span class="string">...</span></span><br><span class="line">             <span class="attr">&#123;</span></span><br><span class="line">                <span class="attr">test</span>: <span class="string">/\.(scss)$/,</span></span><br><span class="line">                <span class="attr">use</span>: <span class="string">[</span></span><br><span class="line">                    <span class="attr">&#123;</span></span><br><span class="line">                        <span class="attr">loader</span>: <span class="string">MiniCssExtractPlugin.loader,</span></span><br><span class="line">                        <span class="attr">options</span>: <span class="string">&#123;</span></span><br><span class="line">                            <span class="attr">publicPath</span>: <span class="string">'../',</span></span><br><span class="line">                        <span class="attr">&#125;</span></span><br><span class="line">                    <span class="attr">&#125;,</span></span><br><span class="line">                    <span class="attr">&#123;</span></span><br><span class="line">                        <span class="attr">loader</span>: <span class="string">'css-loader',</span></span><br><span class="line">                    <span class="meta">&#125;,</span> <span class="string">&#123;</span></span><br><span class="line">                        <span class="attr">loader</span>: <span class="string">'sass-loader',</span></span><br><span class="line">                    <span class="attr">&#125;</span></span><br><span class="line">                <span class="attr">]</span></span><br><span class="line">            <span class="attr">&#125;</span></span><br><span class="line">        <span class="attr">]</span></span><br><span class="line">    <span class="attr">&#125;</span></span><br><span class="line"><span class="attr">&#125;</span></span><br></pre></td></tr></table></figure>

                </div>
            </div>
        </div>
    </div>
</div>

</body>
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/diaspora.js"></script>
<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">
<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>


<!-- 
 -->
</html>