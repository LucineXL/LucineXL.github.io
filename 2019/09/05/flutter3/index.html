
<!DOCTYPE html>
<html lang="zh-CN" class="loading">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lucine-XL</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate">
    <meta name="keywords" content="LucineXL,"> 
    <meta name="description" content="我是一个小码农~,"> 
    <meta name="author" content="Lucine"> 
    <link rel="alternative" href="atom.xml" title="Lucine-XL" type="application/atom+xml"> 
    <link rel="icon" href="/img/li.png"> 
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <link rel="stylesheet" href="/css/diaspora.css">
    <!-- <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> -->
    <script>
    //   (adsbygoogle = window.adsbygoogle || []).push({
    //     google_ad_client: "ca-pub-8691406134231910",
    //     enable_page_level_ads: true
    //   });
    </script>

</head>
</html>
<body class="loading">
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="icon-home image-icon" href="javascript:;"></a>
    <div title="播放/暂停" class="icon-play"></div>
    <h3 class="subtitle">从零开始学Flutter (3) flutter 初体验</h3>
    <div class="social">
        <!--<div class="like-icon">-->
            <!--<a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
        <!--</div>-->
        <div>
            <div class="share">
                <a title="获取二维码" class="icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>
    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">从零开始学Flutter (3) flutter 初体验</h1>
        <div class="stuff">
            <span>九月 05, 2019</span>
            
  <ul class="post-tags-list"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/flutter/">flutter</a></li></ul>


        </div>
        <div class="content markdown">
            <p>往期链接：</p>
<ul>
<li><a href="https://lucinexl.github.io/2019/08/21/flutter1/">从零开始学Flutter (1) 初识Flutter</a></li>
<li><a href="https://lucinexl.github.io/2019/08/22/flutter2/">从零开始学Flutter (2) Flutter 开发环境搭建</a></li>
</ul>
<h2 id="flutter框架结构"><a href="#flutter框架结构" class="headerlink" title="flutter框架结构"></a>flutter框架结构</h2><p>我们看一下Flutter官方提供的Flutter框架图<br><img src="https://cdn.jsdelivr.net/gh/flutterchina/flutter-in-action/docs/imgs/1-1.png" alt="flutter框架图"></p>
<h3 id="Flutter-Framework"><a href="#Flutter-Framework" class="headerlink" title="Flutter Framework"></a>Flutter Framework</h3><p>Dart实现的SDK, 他实现了一套基础库。</p>
<ul>
<li><p>底下两层（Foundation和Animation、Painting、Gestures）在Google的一些视频中被合并为一个dart UI层，对应的是Flutter中的dart:ui包，它是Flutter引擎暴露的底层UI库，提供动画、手势及绘制能力。</p>
</li>
<li><p>Rendering层，这一层是一个抽象的布局层，它依赖于dart UI层，Rendering层会构建一个UI树，当UI树有变化时，会计算出有变化的部分，然后更新UI树，最终将UI树绘制到屏幕上，这个过程类似于React中的虚拟DOM。Rendering层可以说是Flutter UI框架最核心的部分，它除了确定每个UI元素的位置、大小之外还要进行坐标变换、绘制(调用底层dart:ui)。</p>
</li>
<li><p>Widgets层是Flutter提供的的一套基础组件库，在基础组件库之上，Flutter还提供了 Material 和Cupertino两种视觉风格的组件库。Material 用于 Android，Cupertino 用于 iOS。<strong>而我们Flutter开发的大多数场景，只是和这两层打交道</strong>。</p>
</li>
</ul>
<h3 id="Flutter-Engine"><a href="#Flutter-Engine" class="headerlink" title="Flutter Engine"></a>Flutter Engine</h3><p>这是一个纯 C++实现的 SDK，其中包括了 Skia引擎、Dart运行时、文字排版引擎等。在代码调用 dart:ui库时，调用最终会走到Engine层，然后实现真正的绘制逻辑。</p>
<h2 id="flutter-的基础-Widget"><a href="#flutter-的基础-Widget" class="headerlink" title="flutter 的基础 - Widget"></a>flutter 的基础 - Widget</h2><p>在进行Flutter 开发时， 一切都离不开 Widget，Widget是 Flutter 的基础。 在Flutter, 几乎所有的对象都是Widget。我们可以把widget理解成组件或者控件。</p>
<p>Widget的功能是“描述一个UI元素的配置数据”，也就是说，Widget其实并不是表示最终绘制在设备屏幕上的显示元素，而它只是描述显示元素的一个配置数据。而真正绘制在设备屏幕上的显示元素 是 Element。Widget类本身是一个抽象类，其中最核心的就是定义了createElement()接口。 在渲染时， 会通过Widget 生成 element，最终生成真正的UI渲染树。既然Widget只是一份配置数据， 那么 一个Widget 就可以对应多个 Element。</p>
<h3 id="Widget的结构：-Widget树"><a href="#Widget的结构：-Widget树" class="headerlink" title="Widget的结构： Widget树"></a>Widget的结构： Widget树</h3><p>Widget 组合的结构是树，所以叫做 Widget树。</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/3/3/1694414ab4da9231?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="Widget树 结构"></p>
<p>在Widget树中， Widget有包含和被包含关系，但是一个Widget只能有一个根Widget。</p>
<p>在flutter中， 根Widget只能有三种方式：</p>
<ul>
<li>WidgetsApp<br>WidgetsApp 是可以自定义风格的 根Widget。</li>
<li>MaterialApp<br>MaterialApp是基于 WidgetsApp 实现的 Material Design (Android默认的视觉风格) 风格的 根Widget。</li>
<li>CupertinoApp<br>CupertinoApp是基于 WidgetsApp 实现的 iOS 风格的 根Widget。</li>
</ul>
<p>这三个中最常用的是 MaterialApp，因为 MaterialApp 的功能最完善。MaterialApp 经常与 Scaffold 一起使用。</p>
<p>Scaffold 实现了 Material Design 的基本布局结构，例如 AppBar、Drawer、SnackBar 等，所以为了使用这些布局，也必须要使用 Scaffold，所以一个 Flutter App 的 基本结构就是：Root Widget 是 MaterialApp ，然后 MaterialApp 的 子Widget 就是 Scaffold，然后我们在 Scaffolfd 的 子Widget 里写UI。</p>
<h3 id="Widget的种类：-StatefulWidget-和-StatelessWidget"><a href="#Widget的种类：-StatefulWidget-和-StatelessWidget" class="headerlink" title="Widget的种类： StatefulWidget 和 StatelessWidget"></a>Widget的种类： StatefulWidget 和 StatelessWidget</h3><p>渲染是很耗性能的，为了减少不必要的渲染， 根据UI是否会发生变化， 将 Widget 分成了 <code>StatefulWidget</code> 和 <code>StatelessWidget</code>两种。</p>
<h4 id="StatelessWidget：-UI-不可以变化的-Widget"><a href="#StatelessWidget：-UI-不可以变化的-Widget" class="headerlink" title="StatelessWidget： UI 不可以变化的 Widget"></a>StatelessWidget： UI 不可以变化的 Widget</h4><p>StatelessWidget 是没有 State（状态）的 Widget，当 Widget 在运行时不需要改变时，就用 StatelessWidget。</p>
<p>参考demo:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="symbol">'package</span>:flutter/material.dart';</span><br><span class="line"></span><br><span class="line">void main() =&gt; runApp(<span class="type">MyApp</span>());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="type">Widget</span> build(<span class="type">BuildContext</span> context) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">MaterialApp</span>(</span><br><span class="line">      title: <span class="symbol">'Flutter</span> <span class="type">Demo</span>',</span><br><span class="line">      theme: <span class="type">ThemeData</span>(</span><br><span class="line">        primarySwatch: <span class="type">Colors</span>.blue,</span><br><span class="line">      ),</span><br><span class="line">      home: <span class="type">Scaffold</span>(</span><br><span class="line">        body: <span class="type">Text</span>(<span class="string">"Hello World"</span>),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="StatefulWidget：-UI-可以变化的-Widget"><a href="#StatefulWidget：-UI-可以变化的-Widget" class="headerlink" title="StatefulWidget：  UI 可以变化的 Widget"></a>StatefulWidget：  UI 可以变化的 Widget</h4><p>StatefulWidget 是 UI 可以变化的 Widget。</p>
<p>使用StatefulWidget实现一个简单的计数器， 代码实现如下：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="symbol">'package</span>:flutter/material.dart';</span><br><span class="line"></span><br><span class="line">void main () =&gt; runApp(<span class="type">MyApp</span>());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="type">State</span>&lt;<span class="type">StatefulWidget</span>&gt; createState() =&gt; <span class="type">MyAppState</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyAppState</span> <span class="keyword">extends</span> <span class="title">State&lt;MyApp&gt;</span> </span>&#123;</span><br><span class="line">  int _counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  void _countClick() &#123;</span><br><span class="line">    setState(() &#123;</span><br><span class="line">      _counter++;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="type">Widget</span> build(<span class="type">BuildContext</span> context) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">MaterialApp</span>(</span><br><span class="line">      title: <span class="symbol">'flutter</span> demo',</span><br><span class="line">      theme: <span class="type">ThemeData</span>(</span><br><span class="line">        primaryColor: <span class="type">Colors</span>.blue</span><br><span class="line">      ),</span><br><span class="line">      home: <span class="type">Scaffold</span>(</span><br><span class="line">        appBar: <span class="type">AppBar</span>(</span><br><span class="line">          title: <span class="type">Text</span>(<span class="symbol">'flutter</span> demo'),</span><br><span class="line">        ),</span><br><span class="line">         body: <span class="type">Center</span>(</span><br><span class="line">          child: <span class="type">Column</span>(</span><br><span class="line">            mainAxisAlignment: <span class="type">MainAxisAlignment</span>.center,</span><br><span class="line">            children: &lt;<span class="type">Widget</span>&gt;[</span><br><span class="line">              <span class="type">Text</span>(<span class="symbol">'You</span> have pushed the button <span class="keyword">this</span> many times:'),</span><br><span class="line">              <span class="type">Text</span>(_counter.toString()),</span><br><span class="line">            ],</span><br><span class="line">          )</span><br><span class="line">        ),</span><br><span class="line">        floatingActionButton: <span class="type">FloatingActionButton</span>(</span><br><span class="line">          onPressed: _countClick,</span><br><span class="line">          tooltip: <span class="symbol">'Incremen</span>t',</span><br><span class="line">          child: <span class="type">Icon</span>(<span class="type">Icons</span>.add),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>简化一下 MyApp 的结构：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="type">State</span>&lt;<span class="type">StatefulWidget</span>&gt; createState() =&gt; <span class="type">MyAppState</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyAppState</span> <span class="keyword">extends</span> <span class="title">State&lt;MyApp&gt;</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="type">Widget</span> build(<span class="type">BuildContext</span> context) &#123;</span><br><span class="line">      <span class="keyword">return</span> ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看到实现 StatefulWidget，需要两部分组成：</p>
<ul>
<li>StatefulWidget</li>
<li>State</li>
</ul>
<h5 id="StatefulWidget"><a href="#StatefulWidget" class="headerlink" title="StatefulWidget"></a>StatefulWidget</h5><p>StatefulWidget 的实现步骤：</p>
<ul>
<li>继承自 StatefulWidget</li>
<li>通过createState()方法  返回一个State</li>
</ul>
<p>StatefulWidget 的功能就是创建一个State</p>
<h5 id="State"><a href="#State" class="headerlink" title="State"></a>State</h5><p>一个StatefulWidget类会对应一个State类，State表示与其对应的StatefulWidget要维护的状态。</p>
<p>State 的实现步骤：</p>
<ul>
<li>首先继承 State，State 的泛型类型是上面定义的 Widget 的类型</li>
<li>实现 build() 的方法，返回一个 Widget</li>
<li>需要更改数据，刷新 UI 的话，调用 setState()</li>
</ul>
<p>State有两个功能：</p>
<ul>
<li>build() —— 创建 Widget， 用于显示UI</li>
<li>setState() —— 更新状态，刷新 UI</li>
</ul>
<h4 id="State-的生命周期"><a href="#State-的生命周期" class="headerlink" title="State  的生命周期"></a>State  的生命周期</h4><ol>
<li><p>initState</p>
<p>当Widget第一次插入到Widget树时会被调用，对于每一个State对象，Flutter framework只会调用一次该回调。</p>
</li>
<li><p>didChangeDependencies</p>
</li>
</ol>
<p>initState() 方法运行完后，就立即运行 didChangeDependencies() 方法。</p>
<p>当State对象的依赖发生变化时此方法也会被调用。</p>
<ol start="3">
<li>build</li>
</ol>
<p>它主要是用于构建Widget子树的，会在如下场景被调用：</p>
<pre><code>- 在调用initState()之后。
- 在调用didUpdateWidget()之后。
- 在调用setState()之后。
- 在调用didChangeDependencies()之后。
- 在State对象从树中一个位置移除后（会调用deactivate）又重新插入到树的其它位置之后。
</code></pre><ol start="4">
<li>setState</li>
</ol>
<p>当状态有变化，需要刷新UI的时候，就调用 setState()，会触发强制重建 Widget。</p>
<ol start="5">
<li>didUpdateWidget</li>
</ol>
<p>在widget重新构建时，Flutter framework会调用Widget.canUpdate来检测Widget树中同一位置的新旧节点，然后决定是否需要更新，如果Widget.canUpdate返回true则会调用此回调。</p>
<p>在 didUpdateWidget() 里，会把新的 Widget 的配置赋值给 State，相当于重新 initState() 了一次。</p>
<ol start="6">
<li>deactive</li>
</ol>
<p>当State对象从树中被移除时，会调用此回调。</p>
<ol start="7">
<li>dispose</li>
</ol>
<p>当State对象从树中被永久移除时调用；通常在此回调中释放资源。</p>
<ol start="8">
<li>reassemble</li>
</ol>
<p>此回调是专门为了开发调试而提供的，在热重载(hot reload)时会被调用，此回调在Release模式下永远不会被调用。</p>
<p>StatefulWidget生命周期如图所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/flutterchina/flutter-in-action/docs/imgs/3-2.jpg" alt="生命周期"></p>
<p>然后  我们可以通过之前那个计数器的例子  来更加直观的看一下：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="symbol">'package</span>:flutter/material.dart';</span><br><span class="line"></span><br><span class="line">void main () =&gt; runApp(<span class="type">MyApp</span>());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="type">Widget</span> build(<span class="type">BuildContext</span> context) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">MaterialApp</span>(</span><br><span class="line">      title: <span class="symbol">'flutter</span> demo',</span><br><span class="line">      theme: <span class="type">ThemeData</span>(</span><br><span class="line">        primaryColor: <span class="type">Colors</span>.blue</span><br><span class="line">      ),</span><br><span class="line">      home: <span class="type">Count</span>(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Count</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> initCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="type">State</span>&lt;<span class="type">StatefulWidget</span>&gt; createState() =&gt; <span class="type">CountState</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CountState</span> <span class="keyword">extends</span> <span class="title">State&lt;Count&gt;</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  int _counter;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  void initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    <span class="comment">//初始化状态</span></span><br><span class="line">    _counter = widget.initCount;</span><br><span class="line">    print(<span class="string">"initState"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  void _countClick() &#123;</span><br><span class="line">    print(<span class="symbol">'setStat</span>e');</span><br><span class="line">    setState(() &#123;</span><br><span class="line">      _counter++;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="type">Widget</span> build(<span class="type">BuildContext</span> context) &#123;</span><br><span class="line">     print(<span class="string">"build"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Scaffold</span>(</span><br><span class="line">      appBar: <span class="type">AppBar</span>(</span><br><span class="line">        title: <span class="type">Text</span>(<span class="symbol">'flutter</span> demo'),</span><br><span class="line">      ),</span><br><span class="line">        body: <span class="type">Center</span>(</span><br><span class="line">        child: <span class="type">Column</span>(</span><br><span class="line">          mainAxisAlignment: <span class="type">MainAxisAlignment</span>.center,</span><br><span class="line">          children: &lt;<span class="type">Widget</span>&gt;[</span><br><span class="line">            <span class="type">Text</span>(<span class="symbol">'You</span> have pushed the button <span class="keyword">this</span> many times: <span class="number">1</span>'),</span><br><span class="line">            <span class="type">Text</span>(_counter.toString()),</span><br><span class="line">          ],</span><br><span class="line">        )</span><br><span class="line">      ),</span><br><span class="line">      floatingActionButton: <span class="type">FloatingActionButton</span>(</span><br><span class="line">        onPressed: _countClick,</span><br><span class="line">        tooltip: <span class="symbol">'Incremen</span>t',</span><br><span class="line">        child: <span class="type">Icon</span>(<span class="type">Icons</span>.add),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  void didUpdateWidget(<span class="type">Count</span> oldWidget) &#123;</span><br><span class="line">    <span class="keyword">super</span>.didUpdateWidget(oldWidget);</span><br><span class="line">    print(<span class="string">"didUpdateWidget"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  void deactivate() &#123;</span><br><span class="line">    <span class="keyword">super</span>.deactivate();</span><br><span class="line">    print(<span class="string">"deactive"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  void dispose() &#123;</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">    print(<span class="string">"dispose"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  void reassemble() &#123;</span><br><span class="line">    <span class="keyword">super</span>.reassemble();</span><br><span class="line">    print(<span class="string">"reassemble"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  void didChangeDependencies() &#123;</span><br><span class="line">    <span class="keyword">super</span>.didChangeDependencies();</span><br><span class="line">    print(<span class="string">"didChangeDependencies"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们这个时候去启动项目， 就能在终端中看见输出的 log</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Launching <span class="class"><span class="keyword">lib</span>/<span class="title">main</span>.<span class="title">dart</span> <span class="title">on</span> <span class="title">iPhone</span> <span class="title">X</span> <span class="title">in</span> <span class="title">debug</span> <span class="title">mode</span>...</span></span><br><span class="line">Xcode build done.                                            <span class="number">8.0</span>s</span><br><span class="line"><span class="symbol">flutter:</span> initState</span><br><span class="line"><span class="symbol">flutter:</span> didChangeDependencies</span><br><span class="line"><span class="symbol">flutter:</span> build</span><br></pre></td></tr></table></figure>
<p>我们这个时候， 去改变页面的展示文案， 然后我们点击⚡️按钮热重载， 控制台输出日志：</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">flutter:</span> reassemble</span><br><span class="line"><span class="symbol">flutter:</span> didUpdateWidget</span><br><span class="line"><span class="symbol">flutter:</span> build</span><br></pre></td></tr></table></figure>
<p>然后 我们将MyApp中 Count 移除</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="type">Widget</span> build(<span class="type">BuildContext</span> context) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">MaterialApp</span>(</span><br><span class="line">      title: <span class="symbol">'flutter</span> demo',</span><br><span class="line">      theme: <span class="type">ThemeData</span>(</span><br><span class="line">        primaryColor: <span class="type">Colors</span>.blue</span><br><span class="line">      ),</span><br><span class="line">      home: <span class="type">Scaffold</span>(</span><br><span class="line">      appBar: <span class="type">AppBar</span>(</span><br><span class="line">        title: <span class="type">Text</span>(<span class="symbol">'flutter</span> demo'),</span><br><span class="line">      ),</span><br><span class="line">        body: <span class="type">Text</span>(<span class="symbol">'hello</span> world')</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在Count从widget树中移除时，deactive和dispose会依次被调用。 此时可以看到控制台的输出：</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">flutter:</span> reassemble</span><br><span class="line"><span class="symbol">flutter:</span> deactive</span><br><span class="line"><span class="symbol">flutter:</span> dispose</span><br></pre></td></tr></table></figure>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        <li title='0' data-url='http://link.hhtjim.com/163/5146554.mp3'></li>
                    
                        <li title='1' data-url='http://link.hhtjim.com/qq/001faIUs4M2zna.mp3'></li>
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
        data-ae='false'
        data-ci='875d3015f05abfc0a79b'
        data-cs='3192ac1526e44e82c6ff33702190a4123689a827'
        data-r='LucineXL.github.io'
        data-o='LucineXL'
        data-a='LucineXL'
        data-d='false'
    >查看评论</div>


    </div>
    
</div>


    </div>
</div>
</body>
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/diaspora.js"></script>
<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">
<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>


<!-- 
 -->
</html>